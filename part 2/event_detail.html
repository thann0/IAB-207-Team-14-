{% extends "base.html" %}

{% block header %}
  <h1 class="display-6 fw-bold">{{ event.title }}</h1>
  <p class="lead">{{ event.venue }} • {{ event.date_time.strftime('%d %b %Y, %I:%M %p') }}</p>
{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-lg-7">
    <img
      class="img-fluid rounded mb-3"
      alt="{{ event.title }}"
      src="{{ url_for('static', filename='img/' ~ (event.image or 'placeholder.png')) }}"
      onerror="this.onerror=null;this.src='{{ url_for('static', filename='img/placeholder.png') }}';"
    >

    {% if event.status == "Open" %}
      <span class="badge bg-success">Open</span>
    {% elif event.status == "Cancelled" %}
      <span class="badge bg-danger">Cancelled</span>
    {% elif event.status == "Sold Out" %}
      <span class="badge bg-danger">Sold Out</span>
    {% else %}
      <span class="badge bg-secondary">Inactive</span>
    {% endif %}

    <p class="mt-3">{{ event.description }}</p>

    <a href="{{ url_for('main.index') }}" class="btn btn-outline-light mt-3">← Back</a>
    {% if current_user.is_authenticated and event.owner_id == current_user.id %}
      <a href="{{ url_for('main.edit_event', event_id=event.id) }}" class="btn btn-warning mt-3">Edit</a>
      <form class="d-inline" method="post" action="{{ url_for('main.cancel_event', event_id=event.id) }}">
        <button class="btn btn-danger mt-3" onclick="return confirm('Cancel this event?')">Cancel Event</button>
      </form>
    {% endif %}
  </div>

  <div class="col-lg-5">
    <div class="card">
      <div class="card-header">Book Tickets</div>
      <div class="card-body">
        <form method="post">
          {{ booking_form.csrf_token }}
          <label class="form-label">Quantity</label>
          {{ booking_form.quantity(class="form-control") }}
          <div class="mt-2">
            {{ booking_form.submit(class="btn btn-primary", disabled=not current_user.is_authenticated) }}
          </div>
          {% if not current_user.is_authenticated %}
            <div class="form-text">You must be logged in to book.</div>
          {% endif %}
        </form>
      </div>
    </div>

    <div class="card mt-4">
      <div class="card-header">Comments</div>
      <div class="card-body">
        <form method="post">
          {{ comment_form.csrf_token }}
          {{ comment_form.text(class="form-control", placeholder="Write a comment...") }}
          <div class="mt-2">
            {{ comment_form.submit(class="btn btn-secondary", disabled=not current_user.is_authenticated) }}
          </div>
          {% if not current_user.is_authenticated %}
            <div class="form-text">You must be logged in to comment.</div>
          {% endif %}
        </form>
        <hr>
        {% if comments %}
          {% for c in comments %}
            <div class="mb-3">
              <div class="small text-muted">
                {{ c.user.first_name }} {{ c.user.last_name }} · {{ c.created_at.strftime('%d %b %Y %I:%M %p') }}
              </div>
              <div>{{ c.text }}</div>
            </div>
          {% endfor %}
        {% else %}
          <div class="text-muted">No comments yet.</div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
