
{% extends "base.html" %}
{% block title %}My Bookings - SEA Food Festivals{% endblock %}
{% block content %}
<h2>My Booking History</h2>
<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Event</th>
        <th>Date</th>
        <th>Qty</th>
        <th>Status</th>
        <th>Booked At</th>
        <th class="text-end">Actions</th>
      </tr>
    </thead>
    {% if bookings %}
    <tbody>
      {% for b in bookings %}
      <tr class="{% if b.status == 'CANCELLED' %}table-secondary{% endif %}">
        <td><code>{{ b.id }}</code></td>
        <td><a href="{{ url_for('main.details', event_id=b.event_id) }}">{{ b.event_title }}</a></td>
        <td>{{ b.display_dt }}</td>
        <td>{{ b.qty }}</td>
        <td>
          {% if b.status == 'CANCELLED' %}
            <span class="badge text-bg-secondary">CANCELLED</span>
          {% else %}
            <span class="badge text-bg-success">CONFIRMED</span>
          {% endif %}
        </td>
        <td>{{ b.booked_at[:16].replace('T',' ') if b.booked_at else '' }}</td>
        <td class="text-end">
  {% if b.status != 'CANCELLED' %}
  <form method="post" action="{{ url_for('main.cancel_booking', booking_id=b.id) }}" class="d-inline">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit" class="btn btn-outline-danger btn-sm" onclick="return confirm('Are you sure you want to cancel this booking?');">Cancel Booking</button>
  </form>
  {% else %}
    <button class="btn btn-outline-secondary btn-sm" disabled>Not cancellable</button>
  {% endif %}
</td>
      </tr>
      {% endfor %}
    </tbody>
  {% else %}
  </table>
  <div class="alert alert-info">No bookings yet.</div>
  {% endif %}
</div>
{% endblock %}
